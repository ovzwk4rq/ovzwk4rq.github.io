---
layout: post
title: arp에 관해 기억할만한 것들
---
arp query 패킷도 이더넷 같은 링크 계층 서비스를 이용해 전달된다. 링크 계층 서비스가 받는 쪽에 보내는 쪽의 mac 주소를 알려주나? 알려주는지 안알려주는지, 링크 계층 프로토콜에 따라 다른지, 나는 그것은 잘 모르겠다. 하지만 arp는 그것에 상관없이 작동할 수 있도록 설계되었다.

arp query를 받은 노드들 중 query에 담긴 ip 주소에 해당하는 ip 주소를 가진 노드는 응답을 보낸다. 그런데 만약 링크 계층 서비스가 그 arp query를 보낸 노드의 mac 주소를 알려주지 않는다면, 응답을 보낼 때 누구에게 보내야 할지 어떻게 알까? 당연히 arp query 패킷 안에 보내는 쪽의 mac 주소가 들어있기 때문에 알 수 있다.

arp 응답을 보내는 쪽에서 받은 mac 주소를 응답 보내는 데에만 사용하고 버릴 수도 있지만, 그것보다 arp query를 보낸 노드의 mac 주소를 공짜로 알게 되었으므로 arp 테이블에 기록해놓으면 더 좋다.

이러한 원리를 이용해서, ip 주소가 바뀐 노드는 다른 노드들의 arp 테이블을 갱신시키기 위해 자신의 mac 주소를 묻는 arp query를 보낸다고 한다. 이것을 gratuitous(불필요한, 쓸데없는) arp라고 부른다고 한다.

리눅스에서 arp 테이블을 보는 명령어의 이름은 그냥 `arp`이다. `arp -n`을 사용하면 hostname 같은 문자로 된 이름 대신 ip 주소를 볼 수 있다.
