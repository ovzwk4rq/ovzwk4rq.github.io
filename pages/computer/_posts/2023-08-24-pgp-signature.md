---
layout: post
title: pgp signature
---
signature는 서명이라는 뜻이다. 내가 어떤 문서에 서명을 한다는 것은 그 문서를 내가 직접 확인했다는 사실을 표시하는 것이고, 다른 사람이 그 문서에서 내 서명을 보고 내가 확인했다는 사실을 믿을 수 있게 된다. pgp든 뭐든간에 digital signature도 똑같은 역할을 한다. 종종 어떤 사이트에서 프로그램을 다운받으려고 할 때 digital signature도 같이 다운받아서 확인해보라고 하는 사이트가 있는데, 우리는 그걸 통해 우리가 받은 프로그램이 해커에 의해 변조된 프로그램이 아니라 그 사이트의 담당자가 확인한 바로 그 프로그램이라는 것을 확신할 수 있게 되는 것이다.

pgp signature의 대략적인 원리는, 보내는 사람을 A, 받는 사람을 B라고 했을때,  A의 비밀키를 이용해서 메시지를 암호화한 것이 pgp signature이고, 이것을 메시지와 함께 보내면 B는 A의 공개키를 이용해 signature를 복호화한 것이 메시지와 같은지를 확인함으로써 그 메시지가 A가 보낸 것이 맞다는 것을 확신하게 되는 원리이다. (사실 틀린 설명이지만, 이렇게 알고 있어도 아직까지는 사용하는데 지장이 없었다). 다른 사람들은 A의 비밀키를 모르므로 'signature를 어떻게 만들어야 A의 공개키를 적용했을 때 이 메시지가 나오도록 할 수 있을까?' 라는 질문에 답할 수 없기 때문이다.

gpg라는 프로그램을 이용해 그러한 작업들을 할 수 있다.

메시지를 받는 사람은 다음과 같은 과정을 거쳐야 한다. 먼저 공개키를 얻어야 하는데, 웹사이트 어딘가에서 제공하고 있을수도 있고, 신뢰할만한 사람에게 직접 받았을 수도 있다. 그다음 gpg가 그 공개키를 사용할 수 있도록 해주는 과정이 필요한데 이것을 키를 import한다고 한다. 간단히
```
gpg --import <key 파일>
```
이렇게 할 수 있고,
```
gpg --list-keys
```
를 통해 현재 gpg가 사용할 수 있는 모든 공개키를 확인할 수 있다. 그리고 나서 signature를 검증하려면
```
gpg --verify <signature 파일> <메시지 파일>
```
이렇게 하면 된다.

그런데 gpg에 import되어있는 여러 공개키들 중 어떤 공개키를 사용하여 signature를 복호화할지 gpg가 어떻게 알까? signature파일 안에는 signature만 있는게 아니라 여러가지 정보들이 있는데, 어떤 공개키를 사용하여 이 signature를 복호화할지의 정보도 들어있기 때문에, gpg는 signature파일을 보고 그것을 알게 된다. 이 덕분에, 만약 이 공개키가 keyserver에 등록되어 있다면,  공개키를 미리 위에서처럼 `gpg --import`를 이용해 import하지 않고
```
gpg --keyserver-options auto-key-retrieve --verify <signature 파일> <메시지 파일>
```
과 같이 하면 자동으로 keyserver에서 맞는 공개키를 다운받아 import한 후 verify를 진행하게 된다.

하지만 signature파일이 변조될 가능성도 있는데, signature파일에서 내가 생각한 사람의 공개키가 아니라 다른 공개키를 사용하라고 했으면 어떡하나 하는 생각을 할 수 있다. 그렇기 때문에 그냥 `gpg --verify`가 통과되었다고 끝난게 아니라, `gpg --verify`에서 사용한 공개키가 내가 생각한 사람의 공개키가 맞는지를 확인해야 한다. 다행히 `gpg --verify`가 어떤 공개키를 사용했는지를 출력하기 때문에 우리는 그걸 보고 확인할 수 있다. 물론 공개키는 굉장히 길기 때문에 해시값을 출력하는데, 그것을 공개키의 fingerprint라고 부른다. 만약 우리가 신뢰할 수 있는 fingerprint를 가지고 있고(신뢰할 수 있는 사람을 직접 만나서 얻었다든가) 그것이 출력된 fingerprint와 같으면 비로소 우리는 받은 메시지를 신뢰할 수 있게 된다.
